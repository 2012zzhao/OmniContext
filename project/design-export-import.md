# OmniContext å¯¼å‡º/å¯¼å…¥åŠŸèƒ½è®¾è®¡

> çŠ¶æ€ï¼šå¾…è¯„å®¡
> æ—¥æœŸï¼š2026-02-28

---

## ä¸€ã€åŠŸèƒ½æ¦‚è¿°

å…è®¸ç”¨æˆ·å¯¼å‡ºæ‰€æœ‰ä¼šè¯å’Œæ ‡ç­¾æ•°æ®ï¼Œå¹¶åœ¨éœ€è¦æ—¶å¯¼å…¥æ¢å¤ã€‚ç”¨äºï¼š
- æ•°æ®å¤‡ä»½
- è·¨è®¾å¤‡è¿ç§»
- ç‰ˆæœ¬å›æ»š

---

## äºŒã€äº¤äº’è®¾è®¡

### 2.1 å…¥å£ä½ç½®

åœ¨ popup åº•éƒ¨çš„ Footer åŒºåŸŸæ·»åŠ æŒ‰é’®ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ§  OmniContext                 â”‚
â”‚  ...ä¼šè¯åˆ—è¡¨...                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ğŸ“¤ å¯¼å‡º] [ğŸ“¥ å¯¼å…¥] [ğŸ”„ åˆ·æ–°]    â”‚  â† æ–°å¢å¯¼å…¥æŒ‰é’®
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 å¯¼å‡ºåŠŸèƒ½

**è§¦å‘**ï¼šç‚¹å‡»ã€Œå¯¼å‡ºã€æŒ‰é’®

**è¡Œä¸º**ï¼š
1. æ”¶é›†æ‰€æœ‰ä¼šè¯ + æ ‡ç­¾ + ä¼šè¯-æ ‡ç­¾å…³è”
2. ç”Ÿæˆ JSON æ–‡ä»¶
3. è§¦å‘æµè§ˆå™¨ä¸‹è½½

**æ–‡ä»¶åæ ¼å¼**ï¼š
```
omnicontext-backup-2026-02-28.json
```

**æ–‡ä»¶ç»“æ„**ï¼š
```json
{
  "version": "1.0",
  "exportedAt": "2026-02-28T12:00:00.000Z",
  "sessions": [...],
  "tags": [...],
  "sessionTags": {
    "session-id-1": ["tag-id-1", "tag-id-2"],
    "session-id-2": ["tag-id-3"]
  }
}
```

### 2.3 å¯¼å…¥åŠŸèƒ½

**è§¦å‘**ï¼šç‚¹å‡»ã€Œå¯¼å…¥ã€æŒ‰é’®

**è¡Œä¸º**ï¼š
1. æ‰“å¼€æ–‡ä»¶é€‰æ‹©å™¨ï¼ˆåªæ¥å— .json æ–‡ä»¶ï¼‰
2. è¯»å–å¹¶éªŒè¯æ–‡ä»¶æ ¼å¼
3. æ˜¾ç¤ºå¯¼å…¥é€‰é¡¹ï¼ˆè§ä¸‹æ–‡ï¼‰
4. æ‰§è¡Œå¯¼å…¥
5. æ˜¾ç¤ºå¯¼å…¥ç»“æœ

**å¯¼å…¥é€‰é¡¹**ï¼š

| é€‰é¡¹ | è¯´æ˜ |
|------|------|
| å®Œå…¨è¦†ç›– | æ¸…é™¤ç°æœ‰æ•°æ®ï¼Œå®Œå…¨ä½¿ç”¨å¯¼å…¥çš„æ•°æ® |
| åˆå¹¶ï¼ˆä¿ç•™ç°æœ‰ï¼‰ | å¯¼å…¥æ–°æ•°æ®ï¼Œç°æœ‰æ•°æ®ä¿ç•™ï¼Œå†²çªæ—¶ä¿ç•™ç°æœ‰ |
| åˆå¹¶ï¼ˆè¦†ç›–å†²çªï¼‰ | å¯¼å…¥æ–°æ•°æ®ï¼Œç°æœ‰æ•°æ®ä¿ç•™ï¼Œå†²çªæ—¶ä½¿ç”¨å¯¼å…¥çš„ |

**æ¨èé»˜è®¤**ï¼šåˆå¹¶ï¼ˆä¿ç•™ç°æœ‰ï¼‰

### 2.4 å¯¼å…¥ç¡®è®¤å¯¹è¯æ¡†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“¥ å¯¼å…¥ç¡®è®¤                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ–‡ä»¶ï¼šomnicontext-backup.json  â”‚
â”‚  ä¼šè¯æ•°ï¼š25                     â”‚
â”‚  æ ‡ç­¾æ•°ï¼š5                      â”‚
â”‚  å¯¼å‡ºæ—¶é—´ï¼š2026-02-28           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å¯¼å…¥æ–¹å¼ï¼š                     â”‚
â”‚  â—‹ å®Œå…¨è¦†ç›–ï¼ˆå±é™©ï¼‰             â”‚
â”‚  â— åˆå¹¶ï¼ˆä¿ç•™ç°æœ‰ï¼‰æ¨è         â”‚
â”‚  â—‹ åˆå¹¶ï¼ˆè¦†ç›–å†²çªï¼‰             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚       [å–æ¶ˆ]  [ç¡®è®¤å¯¼å…¥]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸‰ã€æŠ€æœ¯æ–¹æ¡ˆ

### 3.1 æ•°æ®ç»“æ„

```typescript
interface ExportData {
  version: string;           // æ ¼å¼ç‰ˆæœ¬å·
  exportedAt: string;        // ISO æ—¶é—´æˆ³
  sessions: Session[];       // æ‰€æœ‰ä¼šè¯
  tags: Tag[];               // æ‰€æœ‰æ ‡ç­¾
  sessionTags: Record<string, string[]>;  // ä¼šè¯-æ ‡ç­¾å…³è”
}
```

### 3.2 å¯¼å‡ºé€»è¾‘

```typescript
async function exportAll(): Promise<void> {
  const sessions = await sessionStorage.getAllSessions();
  const tags = await tagStorage.getAllTags();
  const sessionTags: Record<string, string[]> = {};

  for (const session of sessions) {
    sessionTags[session.id] = await tagStorage.getSessionTags(session.id);
  }

  const data: ExportData = {
    version: '1.0',
    exportedAt: new Date().toISOString(),
    sessions,
    tags,
    sessionTags,
  };

  // ä¸‹è½½æ–‡ä»¶
  downloadJSON(data, `omnicontext-backup-${getDate()}.json`);
}
```

### 3.3 å¯¼å…¥é€»è¾‘

```typescript
type ImportMode = 'replace' | 'merge-keep' | 'merge-overwrite';

async function importAll(file: File, mode: ImportMode): Promise<ImportResult> {
  const data = await parseJSON(file);

  // éªŒè¯æ ¼å¼
  if (!validateExportData(data)) {
    throw new Error('æ— æ•ˆçš„å¤‡ä»½æ–‡ä»¶æ ¼å¼');
  }

  if (mode === 'replace') {
    // æ¸…é™¤ç°æœ‰æ•°æ®
    await clearAllData();
  }

  // å¯¼å…¥æ ‡ç­¾
  for (const tag of data.tags) {
    if (mode === 'merge-keep') {
      const existing = await tagStorage.getTag(tag.id);
      if (!existing) await tagStorage.createTagWithId(tag);
    } else {
      await tagStorage.createTagWithId(tag);
    }
  }

  // å¯¼å…¥ä¼šè¯
  for (const session of data.sessions) {
    if (mode === 'merge-keep') {
      const existing = await sessionStorage.getSession(session.id);
      if (!existing) await sessionStorage.saveSession(session);
    } else {
      await sessionStorage.saveSession(session);
    }
  }

  // å¯¼å…¥ä¼šè¯-æ ‡ç­¾å…³è”
  for (const [sessionId, tagIds] of Object.entries(data.sessionTags)) {
    for (const tagId of tagIds) {
      await tagStorage.addTagToSession(sessionId, tagId);
    }
  }

  return { sessions: data.sessions.length, tags: data.tags.length };
}
```

---

## å››ã€UI å˜æ›´

### 4.1 Footer æŒ‰é’®

**ä¹‹å‰**ï¼š
```
[ğŸ“¤ å¯¼å‡º] [ğŸ”„ åˆ·æ–°]
```

**ä¹‹å**ï¼š
```
[ğŸ“¤ å¯¼å‡º] [ğŸ“¥ å¯¼å…¥] [ğŸ”„ åˆ·æ–°]
```

æˆ–ä½¿ç”¨ä¸‰ç­‰åˆ†å¸ƒå±€ï¼š
```
[ğŸ“¤ å¯¼å‡º] [ğŸ“¥ å¯¼å…¥] [ğŸ”„ åˆ·æ–°]
```

### 4.2 æ–°å¢æ ·å¼

```css
/* å¯¼å…¥é€‰é¡¹å¯¹è¯æ¡† */
.import-dialog {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0,0,0,0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.import-dialog-content {
  background: white;
  padding: 16px;
  border-radius: 12px;
  width: 90%;
  max-width: 320px;
}
```

---

## äº”ã€å¾…è®¨è®ºé—®é¢˜

1. **æ˜¯å¦éœ€è¦å¯¼å‡ºåŠ å¯†ï¼Ÿ**
   - æ•æ„Ÿå¯¹è¯å†…å®¹å¯èƒ½éœ€è¦ä¿æŠ¤
   - å¢åŠ å¤æ‚åº¦

2. **æ˜¯å¦æ”¯æŒéƒ¨åˆ†å¯¼å‡ºï¼Ÿ**
   - åªå¯¼å‡ºé€‰ä¸­çš„ä¼šè¯
   - æŒ‰å¹³å°/æ ‡ç­¾ç­›é€‰å¯¼å‡º

3. **å¯¼å…¥æ—¶æ˜¯å¦éœ€è¦é¢„è§ˆï¼Ÿ**
   - æ˜¾ç¤ºå°†è¦å¯¼å…¥çš„ä¼šè¯åˆ—è¡¨
   - è®©ç”¨æˆ·é€‰æ‹©æ€§å¯¼å…¥

4. **æ˜¯å¦æ”¯æŒäº‘åŒæ­¥ï¼Ÿ**
   - è‡ªåŠ¨å¤‡ä»½åˆ°äº‘å­˜å‚¨
   - è·¨è®¾å¤‡è‡ªåŠ¨åŒæ­¥

---

## å…­ã€å®ç°è®¡åˆ’

### Phase 1: åŸºç¡€åŠŸèƒ½
- [ ] å®Œå–„å¯¼å‡ºï¼ˆæ·»åŠ æ ‡ç­¾å’Œå…³è”æ•°æ®ï¼‰
- [ ] å¯¼å…¥æ–‡ä»¶é€‰æ‹©
- [ ] åŸºç¡€å¯¼å…¥é€»è¾‘ï¼ˆåˆå¹¶æ¨¡å¼ï¼‰

### Phase 2: å¢å¼ºåŠŸèƒ½
- [ ] å¯¼å…¥é€‰é¡¹ï¼ˆè¦†ç›–/åˆå¹¶ï¼‰
- [ ] å¯¼å…¥ç»“æœæç¤º
- [ ] é”™è¯¯å¤„ç†

### Phase 3: å¯é€‰åŠŸèƒ½
- [ ] éƒ¨åˆ†å¯¼å‡º
- [ ] å¯¼å…¥é¢„è§ˆ
- [ ] æ•°æ®åŠ å¯†

---

**è¯·è¯„å®¡ä»¥ä¸Šè®¾è®¡ï¼Œæœ‰ä»»ä½•æ„è§æˆ–å»ºè®®è¯·åé¦ˆã€‚**
