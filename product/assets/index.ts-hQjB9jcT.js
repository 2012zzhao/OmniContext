import{d as m,e as h,a as u,c as g,s as l}from"./extractor-Cw_yo6D4.js";function r(...t){console.log("[OmniContext]",...t)}let e=null,s=null,o=[];function a(){try{const t=window.location.href;if(e=m(t),!e){r("Platform not detected");return}s=h(t,e),r("Detected:",e,"Session:",s);try{u(e)}catch(n){r("Debug failed:",n)}S()}catch(t){console.error("[OmniContext] Init failed:",t)}}function S(){r("Starting capture..."),setTimeout(()=>{d()},2e3),setInterval(d,3e3)}function d(){if(e)try{const n=g(e).extractMessages();r("Found messages:",n.length),n.length>0&&JSON.stringify(n)!==JSON.stringify(o)&&(r("New messages detected, saving..."),o=n,x())}catch(t){r("Capture error:",t)}}async function x(){if(!(!e||!s))try{const n=g(e).extractTitle();if(o.length===0)return;const i={id:s,platform:e,title:n||"未命名对话",sourceUrl:window.location.href,createdAt:Date.now(),updatedAt:Date.now(),messages:o,messageCount:o.length},c=await l.getSession(s);c&&(i.createdAt=c.createdAt),await l.saveSession(i),r("✓ Saved:",n,`(${o.length}条消息)`)}catch(t){console.error("[OmniContext] Save failed:",t)}}window.debugAIMemoryBridge=()=>{e?u(e):console.log("No platform detected")};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",a):a();let f=location.href;setInterval(()=>{location.href!==f&&(f=location.href,e=null,s=null,o=[],a())},1e3);
