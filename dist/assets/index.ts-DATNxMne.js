import{d as m,e as S,a as g,c as u,s as c}from"./extractor-D3HU5yfN.js";function a(...s){console.log("[OmniContext]",...s)}let e=null,o=null,n=[];function i(){const s=window.location.href;if(e=m(s),!e){a("Platform not detected");return}o=S(s),a("Detected:",e,"Session:",o),g(e),h()}function h(){a("Starting capture..."),d(),setInterval(d,3e3)}function d(){if(!e)return;const t=u(e).extractMessages();a("Found messages:",t.length),t.length>0&&JSON.stringify(t)!==JSON.stringify(n)&&(a("New messages detected, saving..."),n=t,w())}async function w(){if(!e||!o)return;const t=u(e).extractTitle();if(n.length===0)return;const l={id:o,platform:e,title:t||"未命名对话",sourceUrl:window.location.href,createdAt:Date.now(),updatedAt:Date.now(),messages:n,messageCount:n.length};try{const r=await c.getSession(o);r&&(l.createdAt=r.createdAt),await c.saveSession(l),a("✓ Saved:",t,`(${n.length}条消息)`)}catch(r){console.error("Save failed:",r)}}window.debugAIMemoryBridge=()=>{e?g(e):console.log("No platform detected")};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",i):i();let f=location.href;setInterval(()=>{location.href!==f&&(f=location.href,e=null,o=null,n=[],i())},1e3);
